근 1년간 소방수역할만 하다보니 우당탕 개발한 것밖에 기억이 안나는 상태다. 기존 코드에 맞춰서 할뿐이라 좋은 아키텍쳐를 고민하거나 OOP적인 코드를 짜거나 하는건 없었다. 오랜만에 처음부터 개발 해볼 겸 Backend를 개발하는 과정에 대해 차분히 정리하는 시간을 가져보려 한다. 그리고 회사에서 쓸 새로운 모듈도 만들겸.

1. request validation.
2. deserialize
3. change to object
4. process something
    - save on db
    - get from db
5. serialize


내 나름대로의 최선의 아키텍처 구조를 정리해보는 시간이다. 회사에서 내 책임은 신사업 개발과 SI 팀 운영 도우미 역할을 같이 하고 있다. SI진행 중인 프로젝트에 문제가 발생하면 들어가서 작업하던가, 마무리가 잘안되고 있으면 들어간다. 

이 둘을 동시에 진행해야하기때문에 두곳에서 관리하기 용이한 코드 베이스에 대해 계속 고민을 해왔다. 지금까지 버전2까지 만들어 사용중이고 시간날때마다 모듈 기능을 추가하고 있다. 

어느정도 깊이의 코드 베이스를 개발자들이 따를 수 있는지, 개발자 실력에 따라 베이스를 따르는 능력또한 다르게 나타난다. 그래서 낮은 실력의 개발자들도 쉽게 따를 수 있는 코드가 필요했다. 코드베이스를 따라줘야만 내가 긴급하게 들어갔을 때 문제 해결에 용이함이 달라진다. 

마이크로 서비스가 대세가 되고 있지만 어차피 코드 구조를 잘 짜고 이벤트 방식이 어떻게 해야 잘돌아가는지만 잘 안다면 마이크로서비스도 쉽게 적응할수 있다고 생각한다.
마이크로서비스 규모의 서버가 필요하기전까지 쓸만한 구조에 대한 이야기다.)

ddd, 헥사고날, 클린 등 여러 아키텍쳐가 있지만 외국인 개발자들이 계속해서 들어오고 나가고 하는 우리 회사에서는 그런것을 이용할수가 없다. 플젝이 위험해질때마다 내가 들어가야하는 상황이다보니 괜히 복잡한 아키텍처로 코드를 짜게 해버리면 나중에 들어갔을 때 이도저도 아닌 구조가 되어있는 상황이 너무 많았다. 그러다보니 쉬운 구조를 이용하도록 해야 나중에 내가 편했다. 그래서 기반으로 최종 결과물이 Nest.js에서 boilerplate로 제공해주는 구조에 repository, domain layer를 추가하는 것이다. 기존 MVC와 같다고 보면 된다.

그런데 아키텍처를 공부하면 할수록 트렌디한 아키텍쳐들이 그리 특별하지않다는 생각이 강해지는 중이다. OOP만 잘하면 다른 아키텍쳐들은 쉽게 쉽게 이해할수 있다고 믿는 사람이라 그럴수 있는데, 모든 아키텍쳐들은 높은 응집성, 낮은 결합성을 목표로 한다. 그것의 기초가 OOP지않나 싶다. 그래서 OOP적인 코드만은 무조건 넣어야했다. 그래서 Domain 모델을 추가해서 이용중이다. 

viewer 단의 종류에 따라 기능 구현을 다시 하면 안된다. 그러므로 service 레이어에서 모든 기능을 구현하고 viewer단에 따라(http api, socket, message queue)에 따라 분리한다.

rich domain model 기반이다.

모든 것은 모듈로 관리된다.
개별 모듈은 같은 구조를 가진다.

module
    - view layer
        - http layer
        - socket layer
    - service layer
    - domains
    - repository layer

모든 비즈닛 로직은 service, domains 에 작성된다.
